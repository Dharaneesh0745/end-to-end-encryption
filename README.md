# ğŸ¯ System Architecture & Data Flow Diagrams

## 1ï¸âƒ£ Overall System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SECURE MESSAGING SYSTEM                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Terminal 1 (Server)              TCP Socket              Terminal 2 (Client)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          Port 9001              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚
â”‚  server.exe      â”‚         Encrypted Channel      â”‚  client.exe      â”‚
â”‚                  â”‚         (256-bit XOR)          â”‚                  â”‚
â”‚  â€¢ Listens       â”‚                                â”‚  â€¢ Connects      â”‚
â”‚  â€¢ Accepts       â”‚                                â”‚  â€¢ Sends msgs    â”‚
â”‚  â€¢ Receives msgs â”‚                                â”‚  â€¢ Receives msgs â”‚
â”‚  â€¢ Encrypts      â”‚                                â”‚  â€¢ Encrypts      â”‚
â”‚  â€¢ Logs data     â”‚                                â”‚  â€¢ Logs data     â”‚
â”‚                  â”‚                                â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                                   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  logs/messages   â”‚
                    â”‚     .txt file    â”‚
                    â”‚  (5 columns)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2ï¸âƒ£ Connection Handshake Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONNECTION INITIALIZATION                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CLIENT                          SERVER
  â”‚                               â”‚
  â”‚  1. Generate keypair         â”‚
  â”‚     â€¢ pk_c (32 bytes)        â”‚
  â”‚     â€¢ sk_c (32 bytes)        â”‚
  â”‚                               â”‚
  â”‚  2. Connect to port 9001      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚   (TCP SYN)                   â”‚ 3. Accept connection
  â”‚                               â”‚ 4. Generate keypair
  â”‚                               â”‚    â€¢ pk_s (32 bytes)
  â”‚                               â”‚    â€¢ sk_s (32 bytes)
  â”‚                               â”‚
  â”‚  5. Receive pk_s              â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 6. Send pk_s (32 bytes)
  â”‚   (exchange public keys)      â”‚
  â”‚                               â”‚
  â”‚ 7. Send pk_c (32 bytes)       â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ 8. Receive pk_c
  â”‚                               â”‚
  â”‚ âœ… Ready to exchange          â”‚ âœ… Ready to exchange
  â”‚    messages                   â”‚    messages
  â”‚ (Client knows: pk_c, sk_c,    â”‚ (Server knows: pk_s, sk_s,
  â”‚               pk_s)           â”‚               pk_c)
  â”‚                               â”‚
```

---

## 3ï¸âƒ£ Message Encryption Flow (Sender)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MESSAGE ENCRYPTION PROCESS                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Input
    â”‚
    â–¼
"Hello Bob!"  â—„â”€â”€â”€ Maximum 1024 bytes
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                         â”‚
    â–¼                                         â–¼
STEP 1: Generate Nonce           STEP 2: Derive Shared Key
    â”‚                                â”‚
    â””â”€â”€â–º random_bytes(16)      pk_recipient XOR sk_sender
         â†“                      â†“
    Nonce = [16 random bytes]   shared_key = 32 bytes
                                
                                â–¼
                            STEP 3: Encrypt
                                â”‚
                                â””â”€â”€â–º simple_encrypt()
                                    plaintext XOR shared_key
                                    (with state chaining)
                                    â†“
                                Ciphertext = 
                                [encrypted message]

                                â–¼
                            STEP 4: Generate MAC
                                â”‚
                                â””â”€â”€â–º compute_auth()
                                    HASH(ciphertext, sk_sender)
                                    â†“
                                MAC = [16-byte auth code]

                                â–¼
                            STEP 5: Package Message
                                â”‚
                                â””â”€â”€â–º [Nonce | Ciphertext | MAC]
                                    16B   +   (len+16)B   + 16B

                                â–¼
                            STEP 6: Send Over Socket
                                â”‚
                                â””â”€â”€â–º send(socket, packet)

                                â–¼
                            STEP 7: Log to File
                                â”‚
                                â””â”€â”€â–º [Time] | [Sender] | [Original]
                                     | [Hex] | [Details] | [N/A]
```

---

## 4ï¸âƒ£ Message Decryption Flow (Receiver)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MESSAGE DECRYPTION PROCESS                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Socket Receive
    â”‚
    â–¼
[Nonce | Ciphertext | MAC] â—„â”€â”€â”€ From sender
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
    â”‚      â”‚          â”‚      â”‚
    â–¼      â–¼          â–¼      â–¼
   N    C(msg)      MAC   [reserved]

STEP 1: Verify MAC
    â”‚
    â””â”€â”€â–º verify_auth()
        HASH(ciphertext, sk_sender) == received_MAC
        â†“
        âœ“ PASS â”€â”€â–º Continue
        âœ— FAIL â”€â”€â–º Discard message

STEP 2: Derive Shared Key
    â”‚
    â””â”€â”€â–º pk_sender XOR sk_recipient
        = shared_key (32 bytes)

STEP 3: Decrypt
    â”‚
    â””â”€â”€â–º simple_decrypt()
        ciphertext XOR shared_key
        (with state chaining)
        â†“
    Plaintext = "Hello Bob!"

STEP 4: Display
    â”‚
    â””â”€â”€â–º Print to console
        "[Sender] Hello Bob!"

STEP 5: Log to File
    â”‚
    â””â”€â”€â–º [Time] | [Sender] | [N/A]
         | [Hex] | [Details] | [Plaintext]

STEP 6: User Sees
    â”‚
    â–¼
"[Sender] Hello Bob!"
```

---

## 5ï¸âƒ£ Data Structure Layout

### **In-Memory (Arena)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             MEMORY ARENA (1 MB Total)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Arena Metadata: 56 bytes]                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [KeyPair #1: Public (32B) + Secret (32B)]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [KeyPair #2: Public (32B) + Secret (32B)]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Nonce: 16 bytes]                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Ciphertext: Variable (msg_len + 16)]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [MAC: 16 bytes]                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Free Space: ~1 MB - Used]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Log File (Text)**

```
[2024-01-10 14:30:45] | Server (SENT) | Hello Bob! | 02b27a9201... | 256-bit XOR-Chain | Nonce: d203ada0ed... | MAC: 128-bit | Data Length: 63B | N/A
[2024-01-10 14:30:46] | Client (RECEIVED) | N/A | 02b27a9201... | 256-bit XOR-Chain | Nonce: d203ada0ed... | MAC: 128-bit | Data Length: 63B | Hello Bob!
[2024-01-10 14:30:47] | Client (SENT) | Thanks! | 5f3e1a7c9d... | 256-bit XOR-Chain | Nonce: a1b2c3d4e5... | MAC: 128-bit | Data Length: 47B | N/A
```

---

## 6ï¸âƒ£ Encryption Algorithm Visualization

### **XOR-Chain Encryption**

```
PLAINTEXT:   H    e    l    l    o    B    o    b    !
ASCII:      [72] [101][108][108][111][66] [111][98] [33]

SHARED KEY:  [k0] [k1] [k2] [k3] [k4] [k5] [k6] [k7] [k0]...

STATE:       0x00
             â–¼
             [st + k0] XOR [72]  â”€â”€â–º c1 = 0x45 (state = 0x45)
             [45 + k1] XOR [101] â”€â”€â–º c2 = 0x7A (state = 0x7A)
             [7A + k2] XOR [108] â”€â”€â–º c3 = 0x2E (state = 0x2E)
             ...
             
CIPHERTEXT: [0x45] [0x7A] [0x2E] ... [encrypted bytes]

DECRYPTION (Same algorithm, applied to ciphertext):
CIPHERTEXT: [0x45] [0x7A] [0x2E] ...
STATE:      0x00
            â–¼
            [0 + k0] XOR [0x45] â”€â”€â–º 72 = 'H' (state = 0x45)
            [45 + k1] XOR [0x7A] â”€â”€â–º 101 = 'e' (state = 0x7A)
            ...
            
PLAINTEXT:  "Hello Bob!"
```

---

## 7ï¸âƒ£ Class Interaction Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CLASS RELATIONSHIPS                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SimpleCrypto  â”‚ â—„â”€â”€â”€â”
â”‚  (static)      â”‚     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚ Â· random_bytes â”‚     â”‚
â”‚ Â· encrypt      â”‚     â”œâ”€â”€â”€â”€â”€â”€â–º Used by Message
â”‚ Â· decrypt      â”‚     â”‚
â”‚ Â· compute_auth â”‚     â”‚
â”‚ Â· verify_auth  â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CryptoEngine   â”‚ â”€â”€â”€â–ºâ”‚
â”‚ (init)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MemArena      â”‚ â—„â”€â”€â”€â”
â”‚  (memory pool)  â”‚     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚ Â· push()        â”‚     â”‚
â”‚ Â· pop()         â”‚     â”œâ”€â”€â”€â”€â”€â”€â–º Used by
â”‚ Â· clear()       â”‚     â”‚      - Server
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚      - Client
                        â”‚      - KeyPair
                        â”‚      - Message
    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    KeyPair      â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Message
â”‚  Â· public_key   â”‚
â”‚  Â· secret_key   â”‚
â”‚  Â· generate()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Message      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º MessageLogger
â”‚  Â· encrypted    â”‚
â”‚  Â· nonce        â”‚
â”‚  Â· mac          â”‚
â”‚  Â· encrypt()    â”‚
â”‚  Â· decrypt()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MessageLogger    â”‚
â”‚  Â· log_sent()    â”‚
â”‚  Â· log_recv()    â”‚
â”‚  Â· timestamp()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²
        â”‚ writes to
        â–¼
   logs/messages.txt

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SecureServer     â”‚â—„â”€â”€â”€â”€â”¬â”€â”€â–ºâ”‚ SecureClient     â”‚
â”‚ Â· start()        â”‚     â”‚   â”‚ Â· connect()      â”‚
â”‚ Â· run()          â”‚     â”‚   â”‚ Â· run()          â”‚
â”‚ Â· encrypt_msg()  â”‚     â”‚   â”‚ Â· encrypt_msg()  â”‚
â”‚ Â· decrypt_msg()  â”‚     â”‚   â”‚ Â· decrypt_msg()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²                â”‚
        â””â”€â”€â”€â”€TCP/IP â”€â”€â”€â”€â”€â”˜
          (port 9001)
```

---

## 8ï¸âƒ£ Timeline: Message Exchange

```
TIME    SERVER                          CLIENT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
T00     Start listening on :9001
        â”‚
T01                                     Connect to :9001
        Accept connection
        â”‚
T02     Generate keypair (pk_s, sk_s)  Generate keypair (pk_c, sk_c)
        â”‚
T03     Send pk_s â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
        â”‚
T04                                     Receive pk_s
        â”‚                               Send pk_c â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
T05     â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Receive pk_c    â”‚
        â”‚
T06     Ready!                          Ready!
        â”‚                               â”‚
        â”‚ User types: "Hello"           â”‚
T07     â”‚                               â”‚
        â”‚                               Encrypt: "Hello"
        â”‚                               Send: [nonce|cipher|mac]
T08     â—„â”€â”€â”€â”€[nonce|cipher|mac] â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚
T09     Verify MAC
        Decrypt: "Hello"
        Display: "[Client] Hello"
        Log entry: RECEIVED
        â”‚
        â”‚ User types: "Hi!"
T10     â”‚
        Encrypt: "Hi!"
        Send: [nonce|cipher|mac]
        â”‚
T11     â”€â”€â”€â”€â”€â”€â”€[nonce|cipher|mac]â”€â”€â”€â”€â”€â–º
        â”‚
T12                                     Verify MAC
                                        Decrypt: "Hi!"
                                        Display: "[Server] Hi!"
                                        Log entry: RECEIVED
        â”‚
T13     [Continue messaging...]
        â”‚
T14     User types 'exit'
        Close socket
        â”‚
T15                                     Close socket
```

---

## 9ï¸âƒ£ File I/O - Log Structure

```
LOGS FILE: messages.txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚ SECURE MESSAGING SYSTEM - CONVERSATION LOG               â”‚
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                          â”‚
â”‚ Format: [DateTime] | [Sender] | [Original] | [Encrypted]â”‚
â”‚ | [Details] | [Decrypted]                              â”‚
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                          â”‚
â”‚ COLUMN 1        COLUMN 2        COLUMN 3               â”‚
â”‚ DateTime        Sender          Original                â”‚
â”‚ 2024-01-10      Server (SENT)   "Hello!"               â”‚
â”‚ 14:30:45        Client (REC)    "N/A"                  â”‚
â”‚                                                          â”‚
â”‚ COLUMN 4        COLUMN 5        COLUMN 6               â”‚
â”‚ Encrypted       Details         Decrypted               â”‚
â”‚ 02b27a92...     256-bit XOR...  "N/A"                  â”‚
â”‚ 02b27a92...     256-bit XOR...  "Hello!"               â”‚
â”‚                                                          â”‚
â”‚ [continuing entries...]                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Ÿ Process Flow: Complete Cycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             COMPLETE MESSAGE EXCHANGE CYCLE                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER INTERACTION:
  "Type message and press Enter"
         â”‚
         â–¼
  Message Input Buffer
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                      â”‚
    [SENDER]                              [RECEIVER]
         â”‚                                      â”‚
         â–¼                                      â”‚
  Create Message                                â”‚
    - Generate nonce                            â”‚
    - Derive key                                â”‚
    - Encrypt plaintext                         â”‚
    - Compute MAC                               â”‚
         â”‚                                      â”‚
         â–¼                                      â”‚
  Package Message                               â”‚
    [Nonce|Cipher|MAC]                          â”‚
         â”‚                                      â”‚
         â–¼                                      â”‚
  Send over Socket â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    write() to TCP                              â”‚
         â”‚                                      â”‚
                                                â–¼
                                          Receive Packet
                                            read() TCP
                                                â”‚
                                                â–¼
                                          Verify MAC
                                          âœ“ Pass â”€â”€â”€â”€â”
                                          âœ— Fail â”€â”€â–º Discard
                                                â”‚
                                                â–¼
                                          Decrypt Message
                                            - Derive key
                                            - Decrypt text
                                                â”‚
                                                â–¼
                                          Display Message
                                            Console output
                                                â”‚
                                                â–¼
                                          Log Entry
                                            Append to file
                                                â”‚
         â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    [Both write to same log file]
         â”‚
         â–¼
    logs/messages.txt
    (Permanent record)
```

---

## Reference: XOR Encryption

- https://github.com/vineetkia/xor-encryption-c
- https://github.com/mightbesimon/XOR-file-encryption
- https://github.com/m4st3r3k/xor_crypt

---

## Summary

This visual guide shows:
1. **System Architecture** - How server and client interact
2. **Connection Flow** - Key exchange handshake
3. **Encryption Process** - Step-by-step message encryption
4. **Decryption Process** - Step-by-step message decryption
5. **Data Structures** - Memory and file layouts
6. **Algorithm Details** - XOR-Chain cipher visualization
7. **Class Relationships** - How components work together
8. **Timeline** - Message exchange sequence
9. **File Format** - Log file structure
10. **Complete Cycle** - Full message exchange workflow

All diagrams show the complete flow of data through the system! ğŸš€
